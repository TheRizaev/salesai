{% extends 'dashboard/base.html' %}

{% block title %}Настройки{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">⚙️ Настройки</h1>
        <p class="page-subtitle">Управление аккаунтом и предпочтениями</p>
    </div>
</div>

<div style="display: grid; grid-template-columns: 250px 1fr; gap: 30px;">
    <!-- Settings Menu -->
    <div class="glass-card" style="padding: 20px; height: fit-content;">
        <nav style="display: flex; flex-direction: column; gap: 5px;">
            <a href="#profile" class="settings-nav-link active" onclick="showSection('profile', event)">
                <i class="fa-solid fa-user"></i>
                Профиль
            </a>
            <a href="#security" class="settings-nav-link" onclick="showSection('security', event)">
                <i class="fa-solid fa-lock"></i>
                Безопасность
            </a>
            <a href="#notifications" class="settings-nav-link" onclick="showSection('notifications', event)">
                <i class="fa-solid fa-bell"></i>
                Уведомления
            </a>
            <a href="#billing" class="settings-nav-link" onclick="showSection('billing', event)">
                <i class="fa-solid fa-credit-card"></i>
                Подписка
            </a>
        </nav>
    </div>

    <!-- Settings Content -->
    <div>
        <!-- PROFILE SECTION -->
        <div id="profile-section" class="settings-section">
            <div class="glass-card">
                <h2 class="card-title" style="margin-bottom: 30px;">
                    <i class="fa-solid fa-user"></i>
                    Информация профиля
                </h2>

                <form method="POST" style="display: flex; flex-direction: column; gap: 25px;">
                    {% csrf_token %}
                    
                    <div style="display: flex; align-items: center; gap: 20px; padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; font-weight: 700;">
                            {{ request.user.first_name|first|default:"U"|upper }}{{ request.user.last_name|first|default:""|upper }}
                        </div>
                        <div>
                            <button type="button" class="btn btn-secondary" style="padding: 8px 16px; font-size: 0.9rem;">
                                <i class="fa-solid fa-camera"></i>
                                Изменить фото
                            </button>
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px;">
                                JPG, PNG или GIF. Максимум 2MB.
                            </p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 10px; color: white;">
                                Имя
                            </label>
                            <input type="text" name="first_name" value="{{ request.user.first_name }}" placeholder="Ваше имя"
                                style="width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.8); border: 1px solid var(--glass-border); border-radius: 10px; color: white; font-size: 1rem;">
                        </div>

                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: 10px; color: white;">
                                Фамилия
                            </label>
                            <input type="text" name="last_name" value="{{ request.user.last_name }}" placeholder="Ваша фамилия"
                                style="width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.8); border: 1px solid var(--glass-border); border-radius: 10px; color: white; font-size: 1rem;">
                        </div>
                    </div>

                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 10px; color: white;">
                            Email
                        </label>
                        <input type="email" value="{{ request.user.email }}" disabled
                            style="width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.4); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-secondary); font-size: 1rem;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px;">
                            <i class="fa-solid fa-lock"></i> Email нельзя изменить
                        </p>
                    </div>

                    <div style="display: flex; gap: 15px; justify-content: flex-end; padding-top: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="location.reload()">
                            <i class="fa-solid fa-xmark"></i>
                            Отмена
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-check"></i>
                            Сохранить изменения
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- SECURITY SECTION -->
        <div id="security-section" class="settings-section" style="display: none;">
            <div class="glass-card">
                <h2 class="card-title" style="margin-bottom: 30px;">
                    <i class="fa-solid fa-lock"></i>
                    Безопасность
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: white; margin-bottom: 5px;">Пароль</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Последнее изменение: 2 месяца назад</p>
                            </div>
                            <a href="{% url 'account_change_password' %}" class="btn btn-secondary" style="padding: 8px 16px; font-size: 0.9rem;">
                                Изменить пароль
                            </a>
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: white; margin-bottom: 5px;">Двухфакторная аутентификация</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Дополнительная защита вашего аккаунта</p>
                            </div>
                            <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                                <input type="checkbox" style="opacity: 0; width: 0; height: 0;">
                                <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 26px;"></span>
                                <span style="position: absolute; content: ''; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                            </label>
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <h4 style="color: white; margin-bottom: 15px;">Подключенные социальные сети</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255, 255, 255, 0.02); border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <i class="fa-brands fa-google" style="font-size: 1.3rem; color: #DB4437;"></i>
                                    <span style="color: white;">Google</span>
                                </div>
                                <span style="color: var(--text-secondary); font-size: 0.9rem;">Не подключено</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255, 255, 255, 0.02); border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <i class="fa-brands fa-apple" style="font-size: 1.3rem; color: white;"></i>
                                    <span style="color: white;">Apple ID</span>
                                </div>
                                <span style="color: var(--text-secondary); font-size: 0.9rem;">Не подключено</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NOTIFICATIONS SECTION -->
        <div id="notifications-section" class="settings-section" style="display: none;">
            <div class="glass-card">
                <h2 class="card-title" style="margin-bottom: 30px;">
                    <i class="fa-solid fa-bell"></i>
                    Настройки уведомлений
                </h2>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: white; margin-bottom: 5px;">Email уведомления</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Получать уведомления на почту</p>
                            </div>
                            <input type="checkbox" checked style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: white; margin-bottom: 5px;">Новые диалоги</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Уведомлять о новых диалогах с ботами</p>
                            </div>
                            <input type="checkbox" checked style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                    </div>

                    <div style="padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="color: white; margin-bottom: 5px;">Новые лиды</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Уведомлять о захваченных лидах</p>
                            </div>
                            <input type="checkbox" checked style="width: 20px; height: 20px; cursor: pointer;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BILLING SECTION -->
        <div id="billing-section" class="settings-section" style="display: none;">
            <div class="glass-card">
                <h2 class="card-title" style="margin-bottom: 30px;">
                    <i class="fa-solid fa-credit-card"></i>
                    Подписка и оплата
                </h2>

                <div style="padding: 25px; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="color: white; margin-bottom: 5px;">Тариф: Free</h3>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">Бесплатный план</p>
                        </div>
                        <a href="{% url 'pricing' %}" class="btn btn-primary">
                            <i class="fa-solid fa-arrow-up"></i>
                            Улучшить план
                        </a>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="font-size: 2rem; font-weight: 700; color: white;">1</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">Ботов</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="font-size: 2rem; font-weight: 700; color: white;">100</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">Сообщений/мес</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <div style="font-size: 2rem; font-weight: 700; color: white;">0 ₽</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">В месяц</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.settings-nav-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s;
    font-size: 0.95rem;
}

.settings-nav-link:hover {
    background: rgba(255, 255, 255, 0.05);
    color: white;
}

.settings-nav-link.active {
    background: rgba(99, 102, 241, 0.1);
    color: var(--accent-primary);
    font-weight: 600;
}

.settings-nav-link i {
    width: 20px;
    text-align: center;
}
</style>

<script>
function showSection(sectionId, event) {
    event.preventDefault();
    
    // Hide all sections
    document.querySelectorAll('.settings-section').forEach(section => {
        section.style.display = 'none';
    });
    
    // Remove active class from all links
    document.querySelectorAll('.settings-nav-link').forEach(link => {
        link.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(sectionId + '-section').style.display = 'block';
    
    // Add active class to clicked link
    event.target.closest('.settings-nav-link').classList.add('active');
}
</script>
{% endblock %}
